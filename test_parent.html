<!DOCTYPE html>
<html>

<head>
    <title>Qualtrics Mock Parent</title>
</head>

<body>
    <h1>Qualtrics Mock Parent</h1>
    <div id="status" style="padding: 10px; background: #eee; margin-bottom: 10px;">Status: Waiting for experiment...
    </div>
    <div id="summary" style="padding: 10px; border: 1px solid #ccc; display: none;">
        <h3>Summary Data Received:</h3>
        <pre id="data-display"></pre>
    </div>

    <iframe id="eyegaze-iframe" src="index.html?test=1"
        style="width: 100%; height: 600px; border: 1px solid black;"></iframe>

    <script>
        const iframe = document.getElementById('eyegaze-iframe');
        const statusDiv = document.getElementById('status');
        const summaryDiv = document.getElementById('summary');
        const dataDisplay = document.getElementById('data-display');

        // 1. Simulate handshake
        iframe.onload = function () {
            statusDiv.innerText = "Status: Iframe loaded, sending config...";
            console.log("Parent: Sending QUALTRICS_CONFIG");
            iframe.contentWindow.postMessage({
                type: 'QUALTRICS_CONFIG',
                config: {
                    study: 'mock_study',
                    sub: 'mock_subject'
                }
            }, '*');
        };

        // 2. Listen for results
        window.addEventListener('message', function (event) {
            console.log("Parent received message:", event.data);
            if (event.data && event.data.type === 'EYEGAZE_COMPLETE') {
                statusDiv.innerText = "Status: Task Complete!";
                statusDiv.style.background = "#d4edda";
                summaryDiv.style.display = "block";
                dataDisplay.innerText = JSON.stringify(event.data.summary, null, 2);
                console.log("Parent: EYEGAZE_COMPLETE received with summary:", event.data.summary);
            }
        });
    </script>
</body>

</html>